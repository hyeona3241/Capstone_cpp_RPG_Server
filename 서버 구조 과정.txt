êµ¬í˜„ ë¡œë“œë§µ (ë”± í•„ìš”í•œ ìµœì†Œê¸°ëŠ¥ë§Œ)

[0) NetCore (ê³µí†µ IOCP ë¼ì´ë¸ŒëŸ¬ë¦¬)]

í´ë˜ìŠ¤: IocpServer, IocpWorker, Session, PacketHeader, BinaryReader/Writer, BufferPool

ìŠ¤ë ˆë“œ: Accept 1, Worker = min(ì½”ì–´*2, 16) ì •ë„

ì½œë°±: OnConnect/OnRecv/OnSend/OnDisconnect ì¶”ìƒí™”




[1) MainServer (ê²Œì´íŠ¸ì›¨ì´/ë¼ìš°í„°)]

ëª©í‘œ: í´ë¼ ì ‘ì† â†’ UID ë¶€ì—¬ â†’ ì›”ë“œ ì„ íƒ â†’ ì›”ë“œë¡œ ë¼ìš°íŒ… ì¤€ë¹„

í•µì‹¬ í´ë˜ìŠ¤

MainServerApp(ë¶€íŒ…/Config), MainAcceptor(IOCP), MainPacketHandler

WorldRegistry(ë“±ë¡ëœ ì›”ë“œ ëª©ë¡/ë¡œë“œ), UserDirectory(UIDâ†’ì„¸ì…˜)

ìµœì†Œ íŒ¨í‚· (Clientâ†”Main)

C2M_HELLO, M2C_WELCOME{uid,faketoken},

C2M_ENTER_WORLD_REQ{region}, M2C_ENTER_WORLD_ACK{worldAddr,handshakeKey}

ìµœì†Œ íŒ¨í‚· (Worldâ†”Main)

W2M_REGISTER_WORLD{worldId,capacity}, W2M_STATUS,

M2W_ATTACH_USER{uid,handshakeKey}, M2W_DETACH_USER{uid}

ì´ˆê¸° ë¡œê·¸ì¸ì€ ê°€ì§œ í† í° ë°œê¸‰(Mainì´ UID ìƒì„±í•´ì„œ ë‚´ë ¤ì¤Œ)



[2) WorldServer (ë£¸/ì„¸ì…˜/ë¸Œë¡œë“œìºìŠ¤íŠ¸)]

ëª©í‘œ: ì…ì¥/í‡´ì¥, ìœ„ì¹˜ ì—…ë°ì´íŠ¸ ë¸Œë¡œë“œìºìŠ¤íŠ¸

í•µì‹¬ í´ë˜ìŠ¤

WorldServerApp, WorldAcceptor(IOCP), WorldPacketHandler

RoomManager, Room, WorldUser{uid,session,position}

ìµœì†Œ íŒ¨í‚· (Clientâ†”World)

C2W_JOIN{uid,handshakeKey}, W2C_JOIN_OK{roomId,spawnPos}

C2W_MOVE{pos,dir}, W2C_MOVE_BROADCAST{uid,pos,dir}

W2C_PING, C2W_PONG (íƒ€ì„ì•„ì›ƒì€ ë‚˜ì¤‘ì— TimerWheel ì—°ë™)

Mainê³¼ì˜ ë³´ì•ˆ ì—°ê²°ì€ handshakeKey 1íšŒì„± ê²€ì‚¬ë¡œ ì¶©ë¶„(ì´ˆê¸°ì—” ê°„ë‹¨íˆ)



[3) LoginServer (ì‹¤ì œ ì¸ì¦/í† í° ë°œê¸‰)]

ëª©í‘œ: ì´í›„ì— Mainì˜ ê°€ì§œ í† í° ë¡œì§ì„ ëŒ€ì²´

ìµœì†Œ í”Œë¡œìš°: C2L_LOGIN_REQ{id,pw} â†’ L2C_LOGIN_ACK{token}

Mainâ†”Login: M2L_VERIFY_TOKEN{token} â†’ L2M_VERIFY_ACK{uid}

ë¶™ì¼ ë•Œ: Mainì˜ â€œê°€ì§œ í† í° ë°œê¸‰â€ ë¶€ë¶„ì„ â€œLogin ê²€ì¦â€ìœ¼ë¡œ ê°ˆì•„ë¼ìš°ê¸°



[4) ChatServer (ì±„ë„/ë¸Œë¡œë“œìºìŠ¤íŠ¸)]

ëª©í‘œ: ì›”ë“œì™€ ë³„ê°œë¡œ ì±„íŒ… ì±„ë„ ìš´ìš©

Mainâ†”Chat: M2C_JOIN_CHANNEL{uid,channel}, M2C_LEAVE_CHANNEL

Clientâ†”Main(í¬ì›Œë”©)â†”Chat: CHAT_SAY{uid,msg} â†’ CHAT_BROADCAST

ì´ˆê¸°ì—ëŠ” ì›”ë“œ ì„œë²„ê°€ ì±„íŒ…ì„ ì„ì‹œ ëŒ€í–‰í•´ë„ ë¨ (ë‚˜ì¤‘ì— ë¶„ë¦¬)








/_Server_Code
 â”œâ”€ Common/
 â”‚   â”œâ”€ Const.h / Logger.h / ErrorCode.h ...
 â”‚   â””â”€ Math/ (Transform, Vector3 ë“±)
 â”‚
 â”œâ”€ Net/
 â”‚   â”œâ”€ IOCPServer.h / Session.h / PacketFramer.h ...
 â”‚   â””â”€ Protocol/ (ê³µí†µ íŒ¨í‚· êµ¬ì¡°)
 â”‚
 â”œâ”€ World/            â† ğŸŒ ì›”ë“œ ê´€ë ¨ í•µì‹¬ í´ë”
 â”‚   â”œâ”€ World.h / World.cpp             â† ì „ì²´ ì›”ë“œ ìƒíƒœ/ë¡œì§ ê´€ë¦¬
 â”‚   â”œâ”€ WorldConfig.h / WorldConfig.cpp â† ì›”ë“œ ê·œì¹™/ê¸°ë³¸ ì„¤ì • ì •ì˜
 â”‚   â”œâ”€ Entity.h / Entity.cpp           â† ì—”í‹°í‹°(ìºë¦­í„°, ì˜¤ë¸Œì íŠ¸) êµ¬ì¡°ì²´
 â”‚   â”œâ”€ Player.h / Player.cpp           â† UID â†” ì—”í‹°í‹° ë§¤í•‘, í”Œë ˆì´ì–´ ë¡œì§
 â”‚   â””â”€ SpawnSystem.h / SpawnSystem.cpp â† ìŠ¤í° ê·œì¹™, ì´ˆê¸° ë°°ì¹˜ ë¡œì§
 â”‚
 â”œâ”€ MainServer/
 â”‚   â”œâ”€ MainServer.h / MainServer.cpp
 â”‚   â””â”€ PacketHandler_World.cpp         â† World ê´€ë ¨ íŒ¨í‚· ì²˜ë¦¬
 â”‚
 â”œâ”€ Tests/ (ìœ ë‹›í…ŒìŠ¤íŠ¸ìš©)
 â”‚   â””â”€ TestWorld.cpp (World ë‹¨ìœ„ í…ŒìŠ¤íŠ¸)
 â”‚
 â””â”€ main.cpp